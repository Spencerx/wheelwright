env:
    global:
        - REPO_DIR=cymem
        # Commit from your-project that you want to build
        - BUILD_COMMIT=1.31.2
        # pip dependencies to _build_ your project
        - BUILD_DEPENDS="Cython"
        # pip dependencies to _test_ your project.  Include any dependencies
        # that you need, that are also specified in BUILD_DEPENDS, this will be
        # a separate install.
        - TEST_DEPENDS="pytest"
        - PLAT=x86_64
        - UNICODE_WIDTH=32
        - WHEELHOUSE_UPLOADER_USERNAME=travis-worker
        # Following generated with
        # travis encrypt -r your-org/your-project-wheels GITHUB_TOKEN=<token>
        # token generated at https://github.com/settings/tokens
        - secure: "ErsmaiPYRAgZR7XIcM9pfSilAiGX+eGskQuse7ae97QAynBlBvP7bWanT6xsIPlsX6TNf61qFwUGgyP7VSMTh9U0kZs3A9T4Jv2Xtr3QiZBo01Jpb4ovjapO/fF78jvDtlSNz99YamPdHQk4IthhDpXqolr63aj0UdeqnfUV/YGWYT3goCDKvV6TqPfuxbMQaSlP188Q9J2WG+O0LvecvLt1lHR1IzUYN4/X/exoZLEXYLz704N9H+fCT2Qv9NdC0wQqdusped8fXBhtbcfOUekrHZMLh2z/Gfx2/5AbtOTLy53nQosOrsSToo+zCuMDJK/M/LqYg1BvbWFImrSMhFHQODk1Y6sY2x04thaKVzqTMgsxqscs1ee7vhZ0v9D7dH54b4o1EYCVylj53BfD8X9jW7KP2ntAa9LcSz1ZESDiydOUHnFW7ouKTcCBGVOJlYnUHcbTG1V/uTK6PPyXfPr0VargFgBDtNxpN5cGsjfrbMM3CDLkR8eAnNm+WFYRV/L82c4r2We6z5oSldx2GnoSDot3cyT6SSOss8uqle+Lw8Ul3fSk1zsKMIbD0gAdI2bEajFLRzzxkdJS7l11QxgLUUAw9xXZZy1iZgugp2SQF/wj2zHNcS2YvlsnRgMeZ92SWS+NIPTSCIdCiGuccVmqGbw02WKOmgMjpG+O+NI="

language: python
sudo: required
dist: xenial
services: docker
# Don't generate builds for tags
# https://github.com/travis-ci/travis-ci/issues/8051#issuecomment-335517982
# https://docs.travis-ci.com/user/conditional-builds-stages-jobs/
# https://docs.travis-ci.com/user/conditions-v1
if: tag IS blank

matrix:
  include:
    - os: linux
      env: MB_PYTHON_VERSION=2.7
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
        - UNICODE_WIDTH=16
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
        - PLAT=i686
        - UNICODE_WIDTH=16
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.5
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.5
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.6
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.6
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.7
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.7
        - PLAT=i686
    - os: osx
      language: generic
      env:
        - MB_PYTHON_VERSION=2.7
    - os: osx
      language: generic
      env:
        - MB_PYTHON_VERSION=3.5
    - os: osx
      language: generic
      env:
        - MB_PYTHON_VERSION=3.6
    - os: osx
      language: generic
      env:
        - MB_PYTHON_VERSION=3.7

before_install:
    - source multibuild/common_utils.sh
    - source multibuild/travis_steps.sh
    - before_install

install:
    # Maybe get and clean and patch source
    - clean_code $REPO_DIR $BUILD_COMMIT
    - build_wheel $REPO_DIR $PLAT

script:
    - install_run $PLAT

after_success:
    - pip install -U pygithub click
    - ls ${TRAVIS_BUILD_DIR}/wheelhouse/
    - python mb.py upload --repo-id njsmith/cymem-wheels --release-id test-release ${TRAVIS_BUILD_DIR}/wheelhouse
